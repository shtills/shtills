<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Расписание Судебных Заседаний</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #121212;
      color: white;
      padding: 20px;
      display: flex;
      justify-content: space-between;
    }
    .btn {
      background-color: #ff9800;
      border: none;
      padding: 10px 15px;
      margin: 5px;
      color: white;
      border-radius: 8px;
      cursor: pointer;
    }
    .btn:hover {
      background-color: #e68900;
    }
    input, textarea {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border-radius: 6px;
      border: none;
      background: #1f1f1f;
      color: white;
    }
    .card {
      background: #1e1e1e;
      border-left: 5px solid #ff9800;
      margin: 10px 0;
      padding: 15px;
      border-radius: 8px;
      cursor: move;
    }
    #editModal, #addModal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.8);
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: #1f1f1f;
      padding: 20px;
      border-radius: 10px;
      width: 400px;
    }
    #menu {
      background-color: #333;
      padding: 20px;
      border-radius: 8px;
      margin-left: 20px;
      width: 200px;
      flex-shrink: 0;
    }
    #menu h3 {
      margin-bottom: 20px;
    }
    #menu ul {
      list-style: none;
      padding: 0;
    }
    #menu ul li {
      margin: 10px 0;
    }
    .arrow {
      cursor: pointer;
      font-size: 18px;
      color: #ff9800;
      padding: 0 10px;
      vertical-align: middle;
    }
  </style>
</head>
<body>

  <div id="app" style="width: calc(100% - 250px);">
    <h1>Расписание судебных заседаний</h1>
    
    <div id="searchPanel">
      <input type="text" id="searchInput" placeholder="Поиск по данным..." />
      <button class="btn" onclick="searchCases()">Поиск</button>
    </div>

    <textarea id="inputText" placeholder="Вставь текст судебного заседания..."></textarea>
    <button class="btn" onclick="parseText()">Распарсить</button>
    <button class="btn" onclick="clearAll()">Очистить всё</button>

    <div id="cards" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
    <button class="btn" onclick="openAddModal()">Добавить суд вручную</button>
  </div>

  <!-- Меню справа -->
  <div id="menu">
    <h3>Меню</h3>
    <ul>
      <li><button class="btn" onclick="showCourts()">Суды</button></li>
    </ul>
  </div>

  <!-- Модальное окно редактирования -->
  <div id="editModal">
    <div class="modal-content">
      <h3>Редактировать</h3>
      <input id="editNumber" placeholder="Номер иска" />
      <input id="editCourt" placeholder="Суд" />
      <input id="editPlaintiff" placeholder="Истец" />
      <input id="editDefendant" placeholder="Ответчик" />
      <input id="editDate" placeholder="Дата и время" />
      <input id="editPlace" placeholder="Место проведения" />
      <input id="editLink" placeholder="Ссылка" />
      <button class="btn" onclick="saveEdit()">Сохранить</button>
      <button class="btn" onclick="closeModal()">Закрыть</button>
    </div>
  </div>

  <!-- Модальное окно добавления судов вручную -->
  <div id="addModal">
    <div class="modal-content">
      <h3>Добавить суд вручную</h3>
      <input id="addNumber" placeholder="Номер иска" />
      <input id="addCourt" placeholder="Суд" />
      <input id="addPlaintiff" placeholder="Истец" />
      <input id="addDefendant" placeholder="Ответчик" />
      <input id="addDate" placeholder="Дата и время" />
      <input id="addPlace" placeholder="Место проведения" />
      <input id="addLink" placeholder="Ссылка" />
      <button class="btn" onclick="saveAdd()">Добавить</button>
      <button class="btn" onclick="closeAddModal()">Закрыть</button>
    </div>
  </div>

  <script>
    let editingCard = null;

    // Загружаем данные из localStorage
    function loadData() {
      const savedCards = JSON.parse(localStorage.getItem('courtCases')) || [];
      savedCards.forEach(cardData => addCard(cardData));
    }

    // Сохранение данных в localStorage
    function saveData() {
      const allCards = document.querySelectorAll('.card');
      const cardsData = [];
      allCards.forEach(card => {
        const cardData = {
          number: card.querySelector('.num').innerText,
          court: card.querySelector('.court').innerText,
          plaintiff: card.querySelector('.plaintiff').innerText,
          defendant: card.querySelector('.defendant').innerText,
          date: card.querySelector('.date').innerText,
          place: card.querySelector('.place').innerText,
          link: card.querySelector('.link').innerText,
        };
        cardsData.push(cardData);
      });
      localStorage.setItem('courtCases', JSON.stringify(cardsData));
    }

    function searchCases() {
      const searchText = document.getElementById('searchInput').value.toLowerCase();
      const allCards = document.querySelectorAll('.card');
      
      allCards.forEach(card => {
        const cardText = card.innerText.toLowerCase();
        if (cardText.includes(searchText)) {
          card.style.display = 'block';
        } else {
          card.style.display = 'none';
        }
      });
    }

    function parseText() {
      const text = document.getElementById('inputText').value;
      const regex = /Назначено судебное заседание №\s?(\d+)[\s\S]*?Инстанция суда:\s*(.*?)\nНомер Иска:\s*(\d+),?[\s\S]*?Истец:\s*(.*?)\nОтветчик:\s*(.*?)\n[\s\S]*?Место проведения:\s*(.*?)\nДата и время:\s*(.*?)\n[\s\S]*?Ссылка на исковое заявление\n(https?:\/\/\S+)/g;

      let match;
      while ((match = regex.exec(text)) !== null) {
        addCard({
          number: match[1],
          court: match[2],
          plaintiff: match[4],
          defendant: match[5],
          date: match[7],
          place: match[6],
          link: match[8]
        });
      }
    }

    function addCard(data) {
      const card = document.createElement('div');
      card.className = 'card';
      card.setAttribute('draggable', 'true');
      card.setAttribute('ondragstart', 'drag(event)');
      card.setAttribute('ondragover', 'allowDrop(event)');
      card.setAttribute('ondrop', 'drop(event)');
      card.innerHTML = `
        <b>Номер иска:</b> <span class="num">${data.number}</span><br>
        <b>Суд:</b> <span class="court">${data.court}</span><br>
        <b>Истец:</b> <span class="plaintiff">${data.plaintiff}</span><br>
        <b>Ответчик:</b> <span class="defendant">${data.defendant}</span><br>
        <b>Дата и время:</b> <span class="date">${data.date}</span><br>
        <b>Место:</b> <span class="place">${data.place}</span><br>
        <b>Ссылка:</b> <a class="link" href="${data.link}" target="_blank">${data.link}</a><br>
        <span class="arrow" onclick="moveUp(this)">↑</span>
        <span class="arrow" onclick="moveDown(this)">↓</span>
        <button class="btn" onclick="openEditModal(this)">Редактировать</button>
        <button class="btn" onclick="deleteCard(this)">Удалить</button>
      `;
      document.getElementById('cards').appendChild(card);
      saveData();
    }

    function moveUp(arrow) {
      const card = arrow.parentElement;
      const previousCard = card.previousElementSibling;
      if (previousCard) {
        card.parentElement.insertBefore(card, previousCard);
        saveData();
      }
    }

    function moveDown(arrow) {
      const card = arrow.parentElement;
      const nextCard = card.nextElementSibling;
      if (nextCard) {
        card.parentElement.insertBefore(nextCard, card);
        saveData();
      }
    }

    function deleteCard(btn) {
      const card = btn.parentElement;
      card.remove();
      saveData();
    }

    function openEditModal(btn) {
      editingCard = btn.parentElement;
      document.getElementById('editNumber').value = editingCard.querySelector('.num').innerText;
      document.getElementById('editCourt').value = editingCard.querySelector('.court').innerText;
      document.getElementById('editPlaintiff').value = editingCard.querySelector('.plaintiff').innerText;
      document.getElementById('editDefendant').value = editingCard.querySelector('.defendant').innerText;
      document.getElementById('editDate').value = editingCard.querySelector('.date').innerText;
      document.getElementById('editPlace').value = editingCard.querySelector('.place').innerText;
      document.getElementById('editLink').value = editingCard.querySelector('.link').innerText;
      document.getElementById('editModal').style.display = 'flex';
    }

    function closeModal() {
      document.getElementById('editModal').style.display = 'none';
    }

    function saveEdit() {
      if (!editingCard) return;
      editingCard.querySelector('.num').innerText = document.getElementById('editNumber').value;
      editingCard.querySelector('.court').innerText = document.getElementById('editCourt').value;
      editingCard.querySelector('.plaintiff').innerText = document.getElementById('editPlaintiff').value;
      editingCard.querySelector('.defendant').innerText = document.getElementById('editDefendant').value;
      editingCard.querySelector('.date').innerText = document.getElementById('editDate').value;
      editingCard.querySelector('.place').innerText = document.getElementById('editPlace').value;
      editingCard.querySelector('.link').innerText = document.getElementById('editLink').value;
      editingCard.querySelector('.link').href = document.getElementById('editLink').value;
      closeModal();
      saveData();
    }

    function clearAll() {
      document.getElementById('cards').innerHTML = '';
      saveData();
    }

    function showCourts() {
      alert("Отображение раздела Суды");
    }

    // Модальное окно добавления судов вручную
    function openAddModal() {
      document.getElementById('addModal').style.display = 'flex';
    }

    function closeAddModal() {
      document.getElementById('addModal').style.display = 'none';
    }

    function saveAdd() {
      const newCourtData = {
        number: document.getElementById('addNumber').value,
        court: document.getElementById('addCourt').value,
        plaintiff: document.getElementById('addPlaintiff').value,
        defendant: document.getElementById('addDefendant').value,
        date: document.getElementById('addDate').value,
        place: document.getElementById('addPlace').value,
        link: document.getElementById('addLink').value
      };
      addCard(newCourtData);
      closeAddModal();
    }

    // Загрузка данных при старте
    window.onload = loadData;
  </script>

</body>
</html>
